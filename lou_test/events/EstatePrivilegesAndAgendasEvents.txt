namespace = estate_privileges_and_agendas_events

# Estates bailing out the player
country_event = {
	id = estate_privileges_and_agendas_events.2
	title = estate_privileges_and_agendas_events.2.name
	desc = estate_privileges_and_agendas_events.2.desc
	picture = NOBLE_ESTATE_DEMANDS_eventPicture

	trigger = {
		NOT = { crown_land_share = 11 }
		OR = {
			AND = {
				government = monarchy
				has_estate = estate_nobles
			}
			AND = {
				government = republic
				has_estate = estate_burghers
			}
		}
		NOT = {
            has_estate_privilege = estate_nobles_statutory_rights
            has_estate_privilege = estate_burghers_statutory_rights
        }
	}

	mean_time_to_happen = {
		months = 128
		modifier = {
			factor = 0.5
			NOT = { crown_land_share = 6 }
		}
		modifier = {
			factor = 0.5
			NOT = { crown_land_share = 4 }
		}
		modifier = {
			factor = 0.5
			NOT = { crown_land_share = 2 }
		}
		modifier = {
			factor = 0.5
			NOT = { crown_land_share = 1 }
		}
	}

	option = { # Accept the Bail Out
		name = estate_privileges_and_agendas_events.2.a
		custom_tooltip = seize_land_unavailable_from_privilege
		else_if = {
			limit = {
				government = monarchy
			}
			set_estate_privilege = estate_nobles_statutory_rights
		}
		else_if = {
			limit = {
				government = republic
			}
			set_estate_privilege = estate_burghers_statutory_rights
		}
	}

	option = { # Refuse the Bail Out
		name = estate_privileges_and_agendas_events.2.b
	}
}

country_event = {
	id = estate_privileges_and_agendas_events.3
	title = estate_privileges_and_agendas_events.3.name
	desc = estate_privileges_and_agendas_events.3.desc
	picture = NOBLE_ESTATE_DEMANDS_eventPicture

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			pick_random_estate_if_present = { flag = present_agenda estate_action = generate_estate_agenda }
			pick_random_estate_if_present = { flag = present_agenda estate_action = generate_estate_agenda }
			pick_random_estate_if_present = { flag = present_agenda estate_action = generate_estate_agenda }
		}
	}

	after = {
		clr_country_flag = estate_nobles_present_agenda
		clr_country_flag = estate_burghers_present_agenda
		clear_estate_agenda_cache = ROOT
	}

	option = {
		name = estate_privileges_and_agendas_events.3.d
		trigger = { has_country_flag = estate_nobles_present_agenda }
		start_estate_agenda = estate_nobles
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1.5
				NOT = {
					estate_loyalty = {
						loyalty = 30
						estate = estate_nobles
					}
				}
			}
			modifier = {
				factor = 2
				NOT = {
					estate_loyalty = {
						loyalty = 20
						estate = estate_nobles
					}
				}
			}
			modifier = {
				factor = 1.5
				estate_influence = {
					influence = 70
					estate = estate_nobles
				}
			}
			modifier = {
				factor = 2
				is_absolutism_active = yes
				num_of_estate_privileges = {
					estate = estate_nobles
					value = 1
				}
				estate_loyalty = {
					estate = estate_nobles
					higher_than_influence = no
				}
			}
		}
	}

	option = {
		name = estate_privileges_and_agendas_events.3.e
		trigger = { has_country_flag = estate_burghers_present_agenda }
		start_estate_agenda = estate_burghers
		ai_chance = {
			factor = 1
			modifier = {
				factor = 1.5
				NOT = {
					estate_loyalty = {
						loyalty = 30
						estate = estate_burghers
					}
				}
			}
			modifier = {
				factor = 2
				NOT = {
					estate_loyalty = {
						loyalty = 20
						estate = estate_burghers
					}
				}
			}
			modifier = {
				factor = 1.5
				estate_influence = {
					influence = 70
					estate = estate_burghers
				}
			}
			modifier = {
				factor = 2
				is_absolutism_active = yes
				num_of_estate_privileges = {
					estate = estate_burghers
					value = 1
				}
				estate_loyalty = {
					estate = estate_burghers
					higher_than_influence = no
				}
			}
		}
	}
}

country_event = {
	id = estate_privileges_and_agendas_events.4
	title = estate_privileges_and_agendas_events.4.name
	desc = estate_privileges_and_agendas_events.4.desc
	picture = NOBLE_ESTATE_DEMANDS_eventPicture

	is_triggered_only = yes
	hidden = yes

	trigger = {
		OR = {
			has_estate_privilege = estate_nobles_supremacy_over_crown
		}
		NOT = { has_any_active_estate_agenda = yes }
	}

	immediate = {
		country_event = { id = estate_privileges_and_agendas_events.3 }
	}

	option = {
		name = estate_privileges_and_agendas_events.4.a
	}
}