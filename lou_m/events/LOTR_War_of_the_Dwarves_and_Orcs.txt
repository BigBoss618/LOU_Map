########################################
# Events for Erebor
#
#
########################################

namespace = war_of_the_dwarves_and_orcs
normal_or_historical_nations = yes

country_event = {
	id = war_of_the_dwarves_and_orcs.1
	title = "war_of_the_dwarves_and_orcs.1.t"
	desc = "war_of_the_dwarves_and_orcs.1.d"
	picture = CONQUEST_eventPicture
	
	major = yes
	fire_only_once = yes
	
	trigger = {
		is_year = 2793
		has_global_flag = desolation_of_smaug_lost
		tag = Y16
		war_of_the_dwarves_and_orcs_goblin_moria_exists = yes
		
		NOT = { 
			281 = {
				owned_by = ROOT
			}
			739 = {
				owned_by = ROOT
			}
			740 = {
				owned_by = ROOT
			}
			has_global_flag = war_of_the_dwarves_and_orcs
			has_country_flag = war_of_the_dwarves_and_orcs_starts
			has_country_flag = war_of_the_dwarves_and_orcs_lost
			has_country_flag = war_of_the_dwarves_and_orcs_wins
		}
	}

	option = {
		name = "war_of_the_dwarves_and_orcs.1.a"
		custom_tooltip = war_of_the_dwarves_and_orcs_text_1
		kill_heir = yes
		define_heir = {
			claim = 100
			dynasty = ROOT
			name = "Thorin Bit Durin"
			adm = 4
			dip = 3
			mil = 4
			age = 15
		}

		khazad_dum_area = {
			add_core = ROOT
		}
		set_global_flag = war_of_the_dwarves_and_orcs
		hidden_effect = {
			country_event = {
				id = war_of_the_dwarves_and_orcs.2
				days = 30
			}
			country_event = {
				id = war_of_the_dwarves_and_orcs.3
				days = 60
			}
			country_event = {
				id = war_of_the_dwarves_and_orcs.4
				days = 90
			}
			add_country_modifier = {
				name = war_of_dwarves_and_orcs
				duration = 2548
			}
			
			Y57 = {
				add_historical_rival = Y16
			}
			add_historical_rival = Y57
		}
	}
	
	option = {
		name = "war_of_the_dwarves_and_orcs.1.b"
		custom_tooltip = war_of_the_dwarves_and_orcs_text_1
		set_global_flag = war_of_the_dwarves_and_orcs_aborted
	}	
}

country_event = {
	id = war_of_the_dwarves_and_orcs.2
	title = "war_of_the_dwarves_and_orcs.2.t"
	desc = "war_of_the_dwarves_and_orcs.2.d"
	picture = CONQUEST_eventPicture
	
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		has_global_flag = war_of_the_dwarves_and_orcs
		tag = Y16
		exists = Y57
		NOT = { 
			exists = V53 
			has_country_flag = war_of_the_dwarves_and_orcs_blacklocks
		}
	}

	option = {
		name = "war_of_the_dwarves_and_orcs.2.a"
		capital_scope = {
			infantry = PREV
			infantry = PREV
		}
		set_country_flag = war_of_the_dwarves_and_orcs_blacklocks
	}			
}

country_event = {
	id = war_of_the_dwarves_and_orcs.3
	title = "war_of_the_dwarves_and_orcs.3.t"
	desc = "war_of_the_dwarves_and_orcs.3.d"
	picture = CONQUEST_eventPicture
	
	is_triggered_only = yes
	fire_only_once = yes
	
	trigger = {
		has_global_flag = war_of_the_dwarves_and_orcs
		tag = Y16
		exists = Y57
		NOT = { 
			exists = V53 
			has_country_flag = war_of_the_dwarves_and_orcs_stonefoots
		}
	}

	option = {
		name = "war_of_the_dwarves_and_orcs.3.a"
		capital_scope = {
			infantry = PREV
		}
		set_country_flag = war_of_the_dwarves_and_orcs_stonefoots
	}			
}

country_event = {
	id = war_of_the_dwarves_and_orcs.4
	title = "war_of_the_dwarves_and_orcs.4.t"
	desc = "war_of_the_dwarves_and_orcs.4.d"
	picture = CONQUEST_eventPicture
	
	is_triggered_only = yes
	major = yes
	fire_only_once = yes
	
	trigger = {
		is_year = 2793
		has_global_flag = war_of_the_dwarves_and_orcs
		tag = Y16
		war_of_the_dwarves_and_orcs_goblin_moria_exists = yes
		NOT = { 
			has_country_flag = war_of_the_dwarves_and_orcs_starts
			has_country_flag = war_of_the_dwarves_and_orcs_lost
			has_country_flag = war_of_the_dwarves_and_orcs_wins
		}
	}

	option = {
		name = "war_of_the_dwarves_and_orcs.4.a"
		declare_war_with_cb = {
			who = Y57
			casus_belli = cb_war_of_the_dwarves_and_orcs
		}

		set_global_flag = war_of_the_dwarves_and_orcs_starts
	}			
}

country_event = {
	id = war_of_the_dwarves_and_orcs.5
	title = "war_of_the_dwarves_and_orcs.5.t"
	desc = "war_of_the_dwarves_and_orcs.5.d"
	picture = CONQUEST_eventPicture
	
	major = yes
	fire_only_once = yes
	
	trigger = {
		has_country_flag = war_of_the_dwarves_and_orcs_starts
		tag = Y16
		has_truce = Y57
		OR = {
			281 = {
				owned_by = ROOT
			}
			739 = {
				owned_by = ROOT
			}
			740 = {
				owned_by = ROOT
			}
		}
		#had_recent_war = 0.1
		NOT = { 
			exists = V53 	
			has_global_flag = war_of_the_dwarves_and_orcs_wins
			has_global_flag = war_of_the_dwarves_and_orcs_lost
		}
	}

	option = {
		name = "war_of_the_dwarves_and_orcs.5.a"
		change_tag = V53
		add_stability = 2
		add_prestige = 50
		add_legitimacy = 25
		
		khazad_dum_area = {
			limit = {
				owned_by = ROOT
			}
			change_culture = culture_longbeard
			change_religion = religion_mahal
		}
		set_global_flag = war_of_the_dwarves_and_orcs_wins
	}			
}

country_event = {
	id = war_of_the_dwarves_and_orcs.6
	title = "war_of_the_dwarves_and_orcs.6.t"
	desc = "war_of_the_dwarves_and_orcs.6.d"
	picture = CONQUEST_eventPicture
	
	is_triggered_only = yes
	major = yes
	fire_only_once = yes
	
	trigger = {
		tag = Y16

		FROM = {
			tag = Y57
		}

		has_global_flag = war_of_the_dwarves_and_orcs_starts
		NOT = {  	
			has_global_flag = war_of_the_dwarves_and_orcs_lost
			has_global_flag = war_of_the_dwarves_and_orcs_wins	
		}
	}
	#Y13 Thorins Halls

	option = {
		name = "war_of_the_dwarves_and_orcs.6.a"
		custom_tooltip = war_of_the_dwarves_and_orcs_text_2
		add_prestige = -50
		set_global_flag = war_of_the_dwarves_and_orcs_lost
		hidden_effect = {
			if = { 
				limit = {
					Y13 = {
						ai = yes
					}
				}
				
				if = {
					limit = {
						ai = no
					}
						switch_tag = Y13
					}
				}
			}
			country_event = {
				id = flavor_ere.15
				days = 1
			}
		}
	}			
}
		
country_event = {
	id = flavor_ere.15
	title = "war_of_the_dwarves_and_orcs.7.t"
	desc = "war_of_the_dwarves_and_orcs.7.d"
	picture = CONQUEST_eventPicture
	
	hidden = yes
	fire_only_once = yes
	
	trigger = {
		has_country_flag = desolation_of_smaug_lost
		has_country_flag = war_of_the_dwarves_and_orcs_lost
		tag = Y04
		559 = {
			owned_by = Y16
		}
		881 = {
			owned_by = Y16
		}
	}

	option = {
		name = "war_of_the_dwarves_and_orcs.7.a"
		559 = {
			cede_province = ---
			change_culture = culture_wilderness
			change_religion = religion_wilderness
			remove_core = Y16
			add_province_modifier = {
				name = wilderness_debuff
				duration = -1
			}
		}
		881 = {
			cede_province = ---
			change_culture = culture_wilderness
			change_religion = religion_wilderness
			remove_core = Y16
			add_province_modifier = {
				name = wilderness_debuff
				duration = -1
			}
		}
		hidden_effect = {
			every_province = {
				kill_units = {
					who = Y16
					amount = 1000
				}
			}
		}
	}			
}
	
country_event = {
	id = flavor_ere.16
	title = "war_of_the_dwarves_and_orcs.8.t"
	desc = "war_of_the_dwarves_and_orcs.8.d"
	picture = CONQUEST_eventPicture
	
	is_triggered_only = yes
	hidden = yes
	fire_only_once = yes
	
	trigger = {
		is_year = 2793
		tag = Y16
		exists = Y57
		war_with = Y57
		is_neighbor_of = Y57
		882 = {
			owned_by = Y57
		}
		285 = {
			owned_by = Y57
		}
		NOT = { 
			exists = V53 
			owns_core_province = 882
			owns_core_province = 285
			has_country_flag = war_of_the_dwarves_and_orcs_lost
			has_country_flag = war_of_the_dwarves_and_orcs_wins
			has_country_flag = war_of_the_dwarves_and_orcs
			has_country_flag = war_of_the_dwarves_and_starts
			has_country_flag = desolation_of_smaug_lost
		}
	}

	option = {
		name = "war_of_the_dwarves_and_orcs.8.a"
		set_country_flag = desolation_of_smaug_lost
		set_country_flag = war_of_the_dwarves_and_orcs
		set_country_flag = war_of_the_dwarves_and_orcs_starts
		infantry = 559
		infantry = 559
		infantry = 559
		add_country_modifier = {
			name = war_of_dwarves_and_orcs
			duration = 2548
		}
	}			
}
		
#V51 = Laketown
#Y16 = Thrors Company
#Y04 - Khagolabbad
#Y05 - Khagolabbad Faraku
#Y18 - Nurunkhizdin
#X43 - Zirakdum
#V53 - Moria(Dwarf)
